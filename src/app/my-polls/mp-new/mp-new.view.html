
<div class="container">
  <div class="row">
    <div class="col-sm-12">
      New Poll
    </div>
  </div>
  <div class="row">
    <div class="col-sm-6">
      <form [formGroup]="newPollForm" novalidate (ngSubmit)="save(newPollForm)">

        <div class="form-group">
          <textarea rows="2" class="form-control" formControlName="question" placeholder="Question"></textarea>
          <small class="text-danger" [hidden]="newPollForm.controls.question.valid
             || (newPollForm.controls.question.pristine && !submitted)">
              Question is required (minimum 6 characters).
          </small>
        </div>

        <div *ngIf="currentRoute === 'edit'">
          <div *ngFor="let option of staticOptions">
            <div class="form-group">
              <input type="text" class="form-inline form-control"  value="{{option}}" disabled>
            </div>
          </div>
        </div>

        <div formArrayName="options">
          <div *ngFor="let option of newPollForm.controls.options.controls; let i=index">
            <!-- Angular assigns array index as group name by default 0, 1, 2, ... -->
            <div [formGroupName]="i" class="form-group">
              <input type="hidden" formControlName="votes">
              <input type="text" class="form-inline form-control" formControlName="option" placeholder="Option">
              <!-- Enable Remove button when more than 2 options exist -->
              <span *ngIf="newPollForm.controls.options.controls.length > minOptions">
                <button type='button' class="btn btn-sm btn-danger" (click)="removeOption(i)">-</button>
              </span>
              <span *ngIf="newPollForm.controls.options.controls.length <= minOptions">
                <button type='button' class="btn btn-sm btn-secondary disabled">-</button>
              </span>
              <!-- Invalid option error message -->
              <small class="text-danger" 
                [hidden]="newPollForm.controls.options.controls[i].controls.option.valid
                || (newPollForm.controls.options.controls[i].controls.option.pristine && !submitted)">
                Option is not valid
              </small>
            </div>
          </div>
        </div>

        <br>
        <div class="margin-20">
          <button type='button' class="btn btn-sm btn-primary" (click)='addOption()'>+ Add Option</button>
        </div>

        <br>
        <button type='button' class="btn btn-md btn-outline-secondary" [routerLink]="['/my-polls']">Cancel</button>
        <button type='button' class="btn btn-md btn-outline-success" type="submit" [disabled]="!newPollForm.valid">
          <span *ngIf="currentRoute === 'new'">Create</span>
          <span *ngIf="currentRoute === 'edit'">Save Options</span>
        </button>
        <div class="margin-20">
          <div>newPollForm details:-</div>
          <pre>Is myForm valid?: <br>{{newPollForm.valid | json}}</pre>
          <pre>form value: <br>{{newPollForm.value | json}}</pre>
        </div>
      </form>
    </div>

    <div class="col-sm-6">
      <div style="display: block">
        <canvas baseChart
          [data]="doughnutChartData"
          [labels]="doughnutChartLabels"
          [chartType]="doughnutChartType"
          (chartHover)="chartHovered($event)"
          (chartClick)="chartClicked($event)">
        </canvas>
      </div>
    </div>

  </div>
</div>


      <!--<div class="form-group form-inline" *ngFor="let option of poll.options; let i = index">
        <input type="text" class="form-control" id="name" placeholder="Option" required>
      </div>-->


<br>
<br>
<button type='button' class="btn btn-md btn-outline-secondary" (click)='logFormState()'>Log Form State</button>
